{% extends "base.html" %}

{% block content %}
<script type="text/javascript">
    function set_btn_color(liked, btn) {
        if (liked === true){
            console.log('change to blue');
                    if (btn.classList.contains('btn-secondary')){
                        btn.classList.toggle('btn-secondary');
                        btn.classList.toggle('btn-primary');
                    }
                }
        else {
            console.log('change to grey');
                    if (btn.classList.contains('btn-primary')) {
                        btn.classList.toggle('btn-primary');
                        btn.classList.toggle('btn-secondary');
                    }
    }
    }

    function is_liked(){
        let video_id = {{video.id | safe}}
        return  $.ajax({
            url: $SCRIPT_ROOT + '{{url_for('watch.json_is_liked') | safe}}',
            data: {video_id: video_id},
            type: 'GET',
            contentType: 'application/json',
            success: function (response) {
                let liked = jQuery.parseJSON(response).is_liked;
                console.log(liked);
                let btn = document.querySelector('#like');
                set_btn_color(liked, btn)
            }
        })
    }

    $(is_liked(liked => {
        liked = jQuery.parseJSON(liked).is_liked;
        console.log(liked);
        let btn = document.querySelector('#like');
        set_btn_color(liked, btn)
    }));

    function like() {
            let video_id = {{video.id | safe}}
            $.ajax({
                url: $SCRIPT_ROOT + '{{url_for('watch.like') | safe}}',
                data: {video_id: video_id},
                type: 'GET',
                success: function (response) {
                    console.log(response);
                    let liked = jQuery.parseJSON(response).is_liked;
                    let btn = document.querySelector('#like');
                    set_btn_color(!liked, btn)
                },
                error: function (error) {
                    console.log(error);
                }
            })
    }
</script>
<figure>
    <video width="1200" height="600" controls="'controls" autoplay>
        <source src="{{pathsep + pathsep.join(['static', 'storage', video.user_id | string, video.created_date.strftime('%m-%d-%Y-%H-%M-%S-%f'), video.file_name]) }}" type="video/mp4">
    </video>
    <h2>{{ video.title }}</h2>
    <a href="{{ url_for('account.profile', user_id=author.id) }}" style="text-decoration: none; color: white">
        <h4>{{ author.name }}</h4>
    </a>
    <p>{{ video.description }}</p>
    <button class="btn btn-secondary" id="like" onclick="like()">Like</button>
    <button class="btn btn-secondary" id="dislike" onclick="disllike()">Dislike</button>
</figure>
{% endblock %}